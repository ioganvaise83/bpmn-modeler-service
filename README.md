📘 BPMN Modeler Service

> **Примечание**: Этот проект является форком [bpmn-io/bpmn-js-examples](https://github.com/bpmn-io/bpmn-js-examples)

Полнофункциональный BPMN-моделировщик с клиент-серверной архитектурой. Веб-приложение для создания, редактирования и управления BPMN-диаграммами с возможностью сохранения на сервер и развертывания в Docker-контейнерах.

## 🚀 Основные возможности

✅ **Визуальное моделирование BPMN** - Интерактивный редактор диаграмм бизнес-процессов
✅ **Клиент-серверная архитектура** - Frontend (JavaScript) + Backend (Go)
✅ **Drag & Drop** - Загрузка BPMN-файлов перетаскиванием
✅ **Экспорт в BPMN и SVG** - Сохранение в BPMN и SVG форматы
✅ **Серверное хранение** - Сохранение и загрузка диаграмм с сервера
✅ **Docker развертывание** - Готовые контейнеры для быстрого запуска
✅ **Горячая перезагрузка** - Автоматическая пересборка при разработке

🗂 Структура проекта

```
📁 bpmn-modeler-service/
├── 📁 src/                    # Исходный код frontend-приложения
│   ├── app.js                 # Основная логика BPMN-редактора
│   ├── style.css              # Стили интерфейса
│   ├── index.html             # HTML-шаблон приложения
│   └── resources/
│       └── newDiagram.bpmn    # Шаблон пустой диаграммы
├── 📁 public/                 # Сборка frontend (автогенерация)
│   ├── app.js                 # Скомпилированный JavaScript
│   └── index.html             # Готовый HTML для продакшена
├── 📁 server/                 # Go backend-сервер
│   ├── main.go                # Сервер для работы с диаграммами
│   └── go.mod                 # Go-модули и зависимости
├── 📁 docs/                   # Документация и скриншоты
├── 📁 server/data/            # BPMN-файлы для тестирования
├── 📁 webpack.config.js       # Конфигурация сборки
├── 📁 package.json            # NPM зависимости и скрипты
├── 📁 docker-compose.yml      # Оркестрация Docker-контейнеров
├── 📁 Dockerfile.backend      # Контейнер для Go-сервера
├── 📁 Dockerfile.frontend     # Контейнер для сборки frontend
├── 📁 nginx.conf              # Конфигурация веб-сервера
└── 📁 README.md               # Документация проекта
```
🚀 Быстрый старт
1. Установка зависимостей
```bash
npm install
```
2. Запуск в режиме разработки
```bash
npm run dev
```
Откроется браузер по адресу:
📂 http://localhost:8080 (или другой, если порт занят)

В этом режиме работает Webpack Dev Server — проект автоматически пересобирается при изменениях.

3. Сборка проекта (production)
```bash
npm run build
```
Сборка будет сохранена в папку public/. Она содержит:

index.html

app.js

другие ассеты

4. Запуск backend-сервера (на Go)
📍 Пререквизит:
Установлен Go

✅ Команда запуска:
```bash
cd server
go run main.go
```
После запуска открой браузер:
🌐 http://localhost:8080

Сервер раздаёт содержимое папки public/.

## 🐳 Docker Развертывание

Проект поддерживает развертывание в Docker-контейнерах для продакшена:

### 🚀 Быстрый запуск с Docker Compose

```bash
# Сборка и запуск всех сервисов
docker-compose up --build

# Запуск в фоновом режиме
docker-compose up -d --build
```

После запуска сервисы будут доступны:
- 🌐 **Frontend**: http://localhost:80 (Nginx)
- 🔧 **Backend API**: http://localhost:8081 (Go сервер)

### 🏗 Ручная сборка контейнеров

```bash
# Сборка frontend
docker build -f Dockerfile.frontend -t bpmn-frontend .

# Сборка backend
docker build -f Dockerfile.backend -t bpmn-backend .

# Запуск контейнеров
docker run -d -p 8081:8081 --name bpmn-api bpmn-backend
docker run -d -p 8080:80 --name bpmn-web bpmn-frontend
```

### 📋 Состав Docker-окружения

- **nginx-frontend** - Веб-сервер и прокси для frontend
- **bpmn-backend** - Go сервер для работы с диаграммами
- **Общие volumes** - Для хранения диаграмм и конфигурации

🔘 Функциональность

| Функция | Описание |
|---------|----------|
| 📂 **Загрузка схемы** | При запуске загружается схема с сервера или используется шаблон по умолчанию |
| 🖱 **Drag & Drop** | Поддержка перетаскивания .bpmn файлов в рабочую область |
| 💾 **Сохранение схемы** | Кнопка "💽 Сохранить схему" отправляет XML на сервер (POST /diagram) |
| 🔁 **Загрузка с сервера** | Кнопка "Загрузить" получает XML с сервера (GET /diagram) |
| ⬇ **Экспорт диаграмм** | Автоматическое создание ссылок для скачивания в форматах BPMN и SVG |
| 🆕 **Создание новой** | Кнопка "Создать диаграмму" загружает пустой шаблон |
| ⚡ **Автосохранение** | Автоматический экспорт при изменении диаграммы |
| 🔄 **Горячая перезагрузка** | Мгновенная пересборка при разработке |

🧩 Технологии и зависимости

**Frontend:**
- ⚡ **bpmn-js** v18.6.2 - BPMN-моделировщик
- 🎯 **jQuery** v3.3.1 - Работа с DOM
- 📦 **Webpack 5** - Сборка и разработка
- 🎨 **CSS3** - Стили интерфейса

**Backend:**
- 🚀 **Go** - Высокопроизводительный сервер
- 🌐 **net/http** - HTTP сервер и клиент
- 📁 **Файловое хранилище** - Локальное хранение диаграмм

**DevOps:**
- 🐳 **Docker** - Контейнеризация
- 🌐 **Nginx** - Веб-сервер и прокси
- 📜 **docker-compose** - Оркестрация сервисов

## 🔧 API Эндпоинты

Backend-сервер предоставляет REST API для работы с диаграммами:

| Метод | Эндпоинт | Описание |
|-------|-----------|----------|
| `GET` | `/diagram` | Получение текущей диаграммы в формате XML |
| `POST` | `/diagram` | Сохранение диаграммы (отправить XML в body) |
| `GET` | `/` | Проверка работоспособности сервера |

**Примеры использования:**

```bash
# Получить диаграмму
curl http://localhost:8081/diagram

# Сохранить диаграмму
curl -X POST http://localhost:8081/diagram \
  -H "Content-Type: application/xml" \
  -d @diagram.bpmn
```

## ⚙️ Конфигурация и настройка

### Настройка портов
- **Frontend**: 8080 (разработка) / 80 (продакшн)
- **Backend API**: 8081

### Конфигурационные файлы
- `nginx.conf` - Конфигурация веб-сервера
- `docker-compose.yml` - Настройки контейнеров
- `webpack.config.js` - Параметры сборки frontend

### Переменные окружения
Backend-сервер поддерживает настройку через переменные:

```bash
PORT=8081                    # Порт сервера
DATA_DIR=./server/data       # Директория для хранения диаграмм
```

🛠 Скрипты package.json

| Скрипт | Назначение |
|--------|------------|
| `npm run dev` | Запуск dev-сервера с автообновлением |
| `npm run build` | Сборка в папку public/ для продакшена |
| `npm run start` | Псевдоним для `npm run dev` |

## 📋 Системные требования

### Для разработки
- **Node.js** >= 14.0.0
- **npm** >= 6.0.0
- **Go** >= 1.16 (для backend-сервера)

### Для продакшена (Docker)
- **Docker** >= 20.0.0
- **Docker Compose** >= 2.0.0

### Браузеры
- Chrome/Chromium >= 88
- Firefox >= 85
- Safari >= 14
- Edge >= 88

## 🔧 Устранение неисправностей

### Проблемы с запуском

**Ошибка: "Порт уже используется"**
```bash
# Найдите процесс, использующий порт
lsof -i :8080
# Или в Windows:
netstat -ano | findstr :8080

# Остановите процесс или измените порт в конфигурации
```

**Ошибка: "Module not found" при npm install**
```bash
# Очистите кэш npm и переустановите зависимости
npm cache clean --force
rm -rf node_modules package-lock.json
npm install
```

### Проблемы с Docker

**Ошибка сборки контейнера**
```bash
# Проверьте синтаксис Dockerfile
docker build --no-cache -f Dockerfile.backend .

# Убедитесь, что все необходимые файлы на месте
ls -la server/
```

**Контейнер не запускается**
```bash
# Проверьте логи контейнера
docker logs <container_name>

# Убедитесь, что порты не заняты
docker ps -a
```

### Проблемы с BPMN-редактором

**Диаграмма не загружается**
- Проверьте консоль браузера (F12) на наличие ошибок JavaScript
- Убедитесь, что backend-сервер запущен на порту 8081
- Проверьте корректность XML в файле диаграммы

**Не работают кнопки экспорта**
- Убедитесь, что диаграмма содержит элементы
- Проверьте консоль на наличие ошибок валидации BPMN

**Проблемы с Drag & Drop**
- Используйте современный браузер (Chrome, Firefox, Safari, Edge)
- Убедитесь, что BPMN-файл имеет расширение .bpmn или .xml

### Проверка работоспособности

```bash
# Проверка backend API
curl http://localhost:8081/

# Проверка frontend
curl http://localhost:8080/

# Проверка Docker-контейнеров
docker-compose ps
```

📄 Лицензия

MIT License

Основано на [bpmn-js-examples](https://github.com/bpmn-io/bpmn-js-examples)  
Copyright (c) 2014-present bpmn.io (https://bpmn.io)  
Copyright (c) 2025 Александр Белов

Полный текст лицензии см. в файле [LICENSE](LICENSE).
